window.doppler=function(){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,t=new e,n=t.createOscillator(),o=2e4,r=33,a=function(e,t){var n=i(e,o),a=t[n],u=.001,c=0;do{c++;var d=t[n-c],f=d/a}while(f>u&&r>c);var v=0;do{v++;var d=t[n+v],f=d/a}while(f>u&&r>v);return{left:c,right:v}},i=function(e,n){var o=t.sampleRate/2;return Math.round(n/o*e.fftSize/2)},u=function(e,n){var o=t.sampleRate/2;return o/(e.fftSize/2)*n},c=function(e,t,n,o){for(var r=e.frequency.value,a=new Uint8Array(t.frequencyBinCount),c=0,d=0,f=i(t,n),v=i(t,o),l=f;v>l;l++)e.frequency.value=u(t,l),t.getByteFrequencyData(a),a[l]>c&&(c=a[l],d=l);return 0==d?r:u(t,d)},d=0,f=function(e,t){var n=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(n);var o=a(e,n);t(o),d=setTimeout(f,1,e,t)},v=function(e,r,a){var i=t.createMediaStreamSource(e),u=t.createAnalyser();u.smoothingTimeConstant=.5,u.fftSize=2048,i.connect(u),n.frequency.value=o,n.type=n.SINE,n.start(0),n.connect(t.destination),setTimeout(function(){o=c(n,u,19e3,22e3),n.frequency.value=o,clearInterval(d),r(u,a)})};return{init:function(e){navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia_({audio:{optional:[{echoCancellation:!1}]}},function(t){v(t,f,e)},function(){console.log("Error!")})},stop:function(){clearInterval(d)}}}(window,document);
